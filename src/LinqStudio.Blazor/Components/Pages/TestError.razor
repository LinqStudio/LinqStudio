@page "/test-error"
@inject ErrorHandlingService ErrorHandlingService

<PageTitle>Test Error Handling</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-4">Error Handling Test Page</MudText>
    
    <MudText Typo="Typo.body1" Class="mb-4">
        This page demonstrates the error handling functionality. Click the buttons below to trigger different types of error dialogs.
    </MudText>

    <MudStack Spacing="3">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@TriggerSimpleError">
            Show Simple Error
        </MudButton>

        <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="@TriggerCustomMessageError">
            Show Error with Custom Message
        </MudButton>

        <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="@TriggerComplexError">
            Show Complex Error with Stack Trace
        </MudButton>
    </MudStack>
</MudContainer>

@code {
    private async Task TriggerSimpleError()
    {
        try
        {
            throw new InvalidOperationException("This is a simple error message for demonstration purposes.");
        }
        catch (Exception ex)
        {
            await ErrorHandlingService.HandleErrorAsync(ex);
        }
    }

    private async Task TriggerCustomMessageError()
    {
        try
        {
            throw new InvalidOperationException("Internal error details that are technical.");
        }
        catch (Exception ex)
        {
            await ErrorHandlingService.HandleErrorAsync(ex, "A user-friendly error message: The operation could not be completed.");
        }
    }

    private async Task TriggerComplexError()
    {
        try
        {
            ThrowNestedError();
        }
        catch (Exception ex)
        {
            await ErrorHandlingService.HandleErrorAsync(ex, "Failed to process the request");
        }
    }

    private void ThrowNestedError()
    {
        try
        {
            // Simulate a nested error
            var dict = new Dictionary<string, string>();
            var value = dict["nonexistent"]; // This will throw KeyNotFoundException
        }
        catch (Exception ex)
        {
            throw new InvalidOperationException("Error in nested operation", ex);
        }
    }
}
