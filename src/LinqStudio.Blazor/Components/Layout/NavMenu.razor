@using LinqStudio.Blazor.Abstractions
@using LinqStudio.Blazor.Components.Pages.Projects

<MudNavMenu>
	<MudNavLink Href="/" Icon="@Icons.Material.Filled.Home" Match="NavLinkMatch.All">Home</MudNavLink>
	
	<!-- Project Node with Actions -->
	<MudNavGroup Title="@GetProjectTitle()" 
				 Icon="@Icons.Material.Filled.Folder" 
				 Expanded="@_projectExpanded">
		
		<MudNavLink Icon="@Icons.Material.Filled.Add" OnClick="NewProject">
			New
		</MudNavLink>
		
		<MudNavLink Icon="@Icons.Material.Filled.FolderOpen" OnClick="OpenProject">
			Open
		</MudNavLink>
		
		@if (Workspace.IsProjectOpen)
		{
			<MudDivider Class="my-2" />
			
			<MudNavLink Icon="@Icons.Material.Filled.Edit" OnClick="EditProject">
				Properties
			</MudNavLink>
			
			<MudNavLink Icon="@Icons.Material.Filled.Save" 
						OnClick="SaveProject"
						Disabled="@(!Workspace.HasUnsavedChanges)">
				Save
			</MudNavLink>
			
			<MudNavLink Icon="@Icons.Material.Filled.SaveAs" OnClick="SaveAsProject">
				Save As...
			</MudNavLink>
			
			<MudNavLink Icon="@Icons.Material.Filled.Close" OnClick="CloseProject">
				Close
			</MudNavLink>
		}
	</MudNavGroup>
	
	@if (Workspace.IsProjectOpen)
	{
		<MudNavGroup Title="Queries" Icon="@Icons.Material.Filled.Code" Expanded="@_queriesExpanded">
			<MudNavLink Href="/editor/new" Icon="@Icons.Material.Filled.Add">
				New Query
			</MudNavLink>
			
			<MudDivider Class="my-2" />
			
			@if (Workspace.CurrentProject!.Queries?.Any() == true)
			{
				@foreach (var (query, index) in Workspace.CurrentProject!.Queries.Select((q, i) => (q, i)))
				{
					<MudNavLink Href="@GetQueryEditorUrl(index)" 
								Icon="@Icons.Material.Filled.Description"
								Match="NavLinkMatch.All">
						@query.Name
					</MudNavLink>
				}
			}
			else
			{
				<MudText Typo="Typo.body2" Color="Color.Secondary" Class="px-4 py-2">
					No queries yet
				</MudText>
			}
		</MudNavGroup>
	}
	else
	{
		<MudNavLink Href="/editor" Icon="@Icons.Material.Filled.Code" Disabled="true">Editor</MudNavLink>
	}
</MudNavMenu>